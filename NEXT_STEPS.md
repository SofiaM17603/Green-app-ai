# üéØ NEXT STEPS - Activer l'int√©gration QuickBooks

‚úÖ **L'int√©gration QuickBooks est pr√™te et test√©e !**

Tous les fichiers ont √©t√© cr√©√©s et test√©s. Il ne reste que quelques √©tapes **manuelles** √† faire pour activer l'int√©gration.

---

## ‚úÖ Ce qui a √©t√© fait automatiquement

- ‚úÖ Structure `quickbooks_integration/` cr√©√©e
- ‚úÖ Code OAuth2 + API QuickBooks √©crit et test√©
- ‚úÖ 6 endpoints FastAPI cr√©√©s
- ‚úÖ Routes int√©gr√©es dans `app.py`
- ‚úÖ D√©pendances ajout√©es √† `requirements.txt`
- ‚úÖ `.env.example` cr√©√© comme template
- ‚úÖ `.gitignore` configur√© pour la s√©curit√©
- ‚úÖ Documentation compl√®te (700+ lignes)
- ‚úÖ Tests automatiques qui passent tous ‚úÖ

**R√©sultat des tests:**
```
‚úÖ PASS - Imports
‚úÖ PASS - File Structure
‚úÖ PASS - Environment Config
‚úÖ PASS - QuickBooks Client
```

---

## üöÄ √âtapes manuelles (15 minutes)

### √âTAPE 1: Cr√©er une app QuickBooks (10 min) üîë

Vous devez cr√©er une application sur le portail d√©veloppeur Intuit pour obtenir vos cl√©s API.

**Actions √† faire:**

1. **Aller sur le portail d√©veloppeur**
   ```
   https://developer.intuit.com/
   ```

2. **Se connecter** avec vos identifiants Intuit/QuickBooks

3. **Cr√©er une nouvelle app**
   - Cliquer sur **"My Apps"** (en haut √† droite)
   - Cliquer sur **"Create an app"**
   - S√©lectionner **"QuickBooks Online and Payments"**
   - Remplir les informations:
     - **App Name:** `Green App Carbon Analytics`
     - **Description:** `Carbon emissions tracking for QuickBooks invoices`
     - **Industry:** Choisir votre industrie
     - **Company:** Nom de votre entreprise

4. **Configurer l'app**
   - Aller dans l'onglet **"Keys & credentials"**
   - Sous la section **"Development"** (pour tester):
     - üìã **Copier le Client ID** (commence par `AB...`)
     - üìã **Copier le Client Secret** (cha√Æne longue)
   - Sous **"Redirect URIs"**, ajouter:
     ```
     http://localhost:8000/quickbooks/callback
     ```
   - Cliquer **"Save"**

5. **Activer les scopes**
   - Aller dans l'onglet **"Scopes"**
   - S'assurer que **"Accounting"** est coch√©
   - Sauvegarder

‚úÖ **Vous avez maintenant vos cl√©s API !**

---

### √âTAPE 2: Configurer le fichier .env (2 min) ‚öôÔ∏è

**Actions √† faire:**

1. **Copier le template**
   ```bash
   cd "/Users/sofia/Desktop/Green App"
   cp .env.example .env
   ```

2. **√âditer le fichier .env**
   ```bash
   nano .env
   ```
   (Ou ouvrir avec votre √©diteur pr√©f√©r√©)

3. **Remplacer les valeurs par vos vraies cl√©s**
   ```env
   QUICKBOOKS_CLIENT_ID=ABgT2eC1hpcPRLUMdZPYtsHwqRCzFgLwhFTENpjtzUj1v7c51L
   QUICKBOOKS_CLIENT_SECRET=oWO2eZRVGNGsaeEjslDAtj2Y82daUYh5OdS47ZZ7
   QUICKBOOKS_REDIRECT_URI=http://localhost:8080/quickbooks/callback
   QUICKBOOKS_ENVIRONMENT=sandbox
   ```


4. **Sauvegarder et fermer**
   - Dans nano: `Ctrl+X`, puis `Y`, puis `Enter`

‚úÖ **Configuration termin√©e !**

---

### √âTAPE 3: D√©marrer le backend (1 min) üöÄ

**Actions √† faire:**

```bash
cd "/Users/sofia/Desktop/Green App"
uvicorn app:app --reload --host 0.0.0.0 --port 8000
```

**Vous devriez voir:**
```
‚úÖ QuickBooks integration loaded successfully
INFO:     Started server process
INFO:     Uvicorn running on http://0.0.0.0:8000
```

‚úÖ **Le backend tourne avec QuickBooks activ√© !**

---

### √âTAPE 4: Se connecter √† QuickBooks (2 min) üîó

**Option A: Avec curl (terminal)**

```bash
curl http://localhost:8000/quickbooks/connect
```

Copiez l'URL dans `auth_url` et collez-la dans votre navigateur.

**Option B: Directement dans le navigateur**

Ouvrir: `http://localhost:8000/quickbooks/connect`

**Actions √† faire:**

1. Vous serez redirig√© vers QuickBooks
2. **Se connecter** avec vos identifiants QuickBooks
3. **S√©lectionner une entreprise** (Sandbox ou r√©elle)
4. Cliquer **"Connect"** pour autoriser Green App
5. Vous serez redirig√© automatiquement vers le callback

**Vous devriez voir:**
```json
{
  "success": true,
  "message": "Successfully connected to QuickBooks!",
  "company": {
    "name": "Votre entreprise",
    "realm_id": "..."
  }
}
```

‚úÖ **Connexion r√©ussie !**

---

### √âTAPE 5: Tester avec vos factures (30 sec) üéâ

**Synchroniser vos factures:**

```bash
curl -X POST "http://localhost:8000/quickbooks/sync?auto_analyze=true"
```

**R√©sultat attendu:**
```json
{
  "success": true,
  "message": "Successfully synced X invoices from QuickBooks",
  "analysis": {
    "total_emissions_kg": ...,
    "invoice_count": ...,
    ...
  }
}
```

‚úÖ **Vos factures sont maintenant dans Green App !**

---

## üé® (Optionnel) Ajouter des boutons dans l'interface

Si vous voulez int√©grer QuickBooks dans votre UI web:

### Ajouter dans `green-app-ui/index.html`

Trouvez la page "Analyser" et ajoutez:

```html
<!-- QuickBooks Integration Section -->
<div class="quickbooks-section" style="margin-top: 2rem;">
    <h3>Ou connectez QuickBooks Online</h3>
    <button class="btn btn-primary" id="qbConnectBtn" onclick="connectQuickBooks()">
        <span>üíº</span> Connect QuickBooks
    </button>
    <button class="btn btn-success" id="qbSyncBtn" onclick="syncQuickBooks()" style="display: none;">
        <span>üîÑ</span> Sync Invoices
    </button>
    <div id="qbStatus" style="margin-top: 1rem; color: #059669;"></div>
</div>
```

### Ajouter dans `green-app-ui/script.js`

```javascript
// QuickBooks Integration Functions
async function connectQuickBooks() {
    try {
        const response = await fetch(`${API_BASE_URL}/quickbooks/connect`);
        const data = await response.json();
        window.open(data.auth_url, '_blank', 'width=800,height=600');
        alert('Please complete authorization in the new window, then refresh this page');
    } catch (error) {
        console.error('Error:', error);
        alert('Failed to connect to QuickBooks');
    }
}

async function syncQuickBooks() {
    try {
        document.getElementById('loadingSpinner').style.display = 'block';
        const response = await fetch(
            `${API_BASE_URL}/quickbooks/sync?auto_analyze=true`,
            { method: 'POST' }
        );
        const data = await response.json();

        if (data.success) {
            alert(`‚úÖ Synced ${data.sync_info.invoice_count} invoices!\n` +
                  `Total emissions: ${data.analysis.total_emissions_kg} kg CO2e`);
            loadDashboard();
            loadFiles();
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Failed to sync invoices');
    } finally {
        document.getElementById('loadingSpinner').style.display = 'none';
    }
}

// Check QB status on page load
async function checkQuickBooksStatus() {
    try {
        const response = await fetch(`${API_BASE_URL}/quickbooks/status`);
        const data = await response.json();

        if (data.connected) {
            document.getElementById('qbConnectBtn').style.display = 'none';
            document.getElementById('qbSyncBtn').style.display = 'inline-flex';
            document.getElementById('qbStatus').textContent =
                `‚úÖ Connected to ${data.company.name}`;
        }
    } catch (error) {
        console.log('QuickBooks not connected');
    }
}

// Call on page load
window.addEventListener('DOMContentLoaded', checkQuickBooksStatus);
```

---

## üìã Checklist de validation

Avant de consid√©rer l'int√©gration comme termin√©e, v√©rifiez:

- [ ] App QuickBooks cr√©√©e sur developer.intuit.com
- [ ] Client ID et Client Secret r√©cup√©r√©s
- [ ] Redirect URI configur√©: `http://localhost:8000/quickbooks/callback`
- [ ] Fichier `.env` cr√©√© avec les vraies valeurs
- [ ] Backend d√©marre avec "‚úÖ QuickBooks integration loaded"
- [ ] `/quickbooks/connect` retourne une auth_url valide
- [ ] Connexion √† QuickBooks r√©ussie (callback OK)
- [ ] `/quickbooks/status` retourne `connected: true`
- [ ] `/quickbooks/sync` r√©cup√®re des factures
- [ ] Dashboard affiche les donn√©es synchronis√©es
- [ ] "Mes Fichiers" affiche le fichier QuickBooks
- [ ] (Optionnel) Boutons ajout√©s dans l'UI

---

## üêõ En cas de probl√®me

### Le backend ne d√©marre pas

**V√©rifier:**
```bash
cd "/Users/sofia/Desktop/Green App"
python test_quickbooks_integration.py
```

Tous les tests doivent passer ‚úÖ

### "Missing required environment variables"

**Solution:**
```bash
# V√©rifier que .env existe
cat .env

# V√©rifier qu'il contient les 3 variables
grep QUICKBOOKS .env
```

### "Redirect URI mismatch"

**Solution:**
1. Aller sur [developer.intuit.com](https://developer.intuit.com/)
2. My Apps ‚Üí Votre app ‚Üí Keys & credentials
3. V√©rifier que `http://localhost:8000/quickbooks/callback` est bien dans Redirect URIs
4. Sauvegarder

### "No invoices found"

**Solution:**
- V√©rifier que vous avez des factures dans QuickBooks
- Essayer avec une plage de dates plus large:
  ```bash
  curl -X POST "http://localhost:8000/quickbooks/sync?start_date=2024-01-01&end_date=2025-12-31"
  ```

**Plus de troubleshooting:** Voir `quickbooks_integration/README.md`

---

## üìö Documentation disponible

| Fichier | Description | Lignes |
|---------|-------------|--------|
| `quickbooks_integration/README.md` | **Documentation compl√®te** avec tous les d√©tails | 700+ |
| `quickbooks_integration/QUICKSTART.md` | **Guide rapide** 5 minutes | 100+ |
| `QUICKBOOKS_INTEGRATION_SUMMARY.md` | **R√©sum√© technique** de l'int√©gration | 600+ |
| `NEXT_STEPS.md` | **Ce fichier** - √âtapes manuelles | - |
| `.env.example` | Template de configuration | - |

---

## üéØ R√©capitulatif

**Ce qui est fait automatiquement (par moi):**
‚úÖ Code QuickBooks OAuth2 + API
‚úÖ Endpoints FastAPI
‚úÖ Transformation des donn√©es
‚úÖ Int√©gration dans app.py
‚úÖ Tests automatiques
‚úÖ Documentation compl√®te

**Ce qui doit √™tre fait manuellement (par vous):**
1. ‚è±Ô∏è Cr√©er app QuickBooks (10 min)
2. ‚è±Ô∏è Configurer .env (2 min)
3. ‚è±Ô∏è D√©marrer backend (1 min)
4. ‚è±Ô∏è Se connecter √† QuickBooks (2 min)

**Total: ~15 minutes** ‚è±Ô∏è

---

## ‚ú® Une fois termin√©

Vous pourrez:
- üíº Connecter votre compte QuickBooks en 1 clic
- üîÑ Synchroniser vos factures automatiquement
- üìä Voir vos √©missions carbone calcul√©es
- üìà Visualiser dans le dashboard Green App
- üå± Obtenir des recommandations personnalis√©es

**Tout sans exporter manuellement de CSV !** üéâ

---

## üéâ Let's Go!

Suivez les √©tapes ci-dessus dans l'ordre, et dans 15 minutes vous aurez QuickBooks int√©gr√© √† Green App !

**Bonne chance ! üöÄüíö**

---

**Questions ?**
- üìñ Documentation: `quickbooks_integration/README.md`
- ‚ö° Guide rapide: `quickbooks_integration/QUICKSTART.md`
- üß™ Tests: `python test_quickbooks_integration.py`
